<!doctype html>
<html lang="en">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="utf-8">

<title>案件をこなせる程度の動画技術</title>

<meta name="description" content="">
<meta name="author" content="tgoikawa">
<meta name="generator" content="reveal-ck 3.9.2">



<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/theme/sky.css" id="theme">

<!-- Code syntax highlighting -->
<link rel="stylesheet" href="lib/css/zenburn.css">

<link rel="stylesheet" href="css/reveal-ck.css">


<!-- Printing and PDF exports -->
<script>
  var link = document.createElement( 'link' );
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->

  </head>

  <body>
    <div class="reveal">
  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">
    <section>

<h2>案件で使える動画配信の知識</h2>

<p>及川 康祐</p>

</section>
<section>

<h2>経緯</h2>

<ul>
  <li>案件で動画関係に携わることがあった</li>
  <li>社内で動画に詳しい人が少ないので共有する必要性を感じた</li>
</ul>

</section>
<section>

<h2>動画配信の種類</h2>

<ul>
  <li>mp4ファイルをhttpsで配信
    <ul>
      <li>mp4ファイルをhttpsで配信する。非ライブ配信で使われる。楽。</li>
    </ul>
  </li>
  <li>ストリーミング配信
    <ul>
      <li>色々種類が多すぎるので今回は割愛</li>
    </ul>
  </li>
</ul>

<p>今日はmp4ファイルをhttpsで配信することに関して話します</p>

</section>
<section>

<h2>mp4ファイルで配信するのは何が嬉しいか</h2>

</section>
<section>

<ul>
  <li>
    <p>GCSにファイル配置してURL参照するだけ</p>
  </li>
  <li>ブラウザで再生する場合videoタグでURL指定するだけ
    <pre><code class="language-html">&lt;video src="https://domain/sample.mp4"&gt;&lt;/video&gt;
</code></pre>
  </li>
  <li>署名付きURLを使用すればセキュリティ上の安全性も確保しやすい</li>
</ul>

</section>
<section>

<h3>ファイルダウンロードしきるまで再生できないのでは?🤔</h3>

</section>
<section>

<h3>そんなこたーない</h3>

<ul>
  <li>主要なブラウザはmp4ファイルをプログレッシブダウンロードすることができる。</li>
</ul>

</section>
<section>
<section>

<h3>プログレッシブダウンロードとは?</h3>

<ul>
  <li>
    <p>ストリーミングと同じようにデータをダウンロードしながら再生すること(疑似ストリーミング再生とも)</p>
  </li>
  <li>
    <p>プログレッシブダウンロードしやすいようにmp4の形式を変更してやる必要がある<br>
→ ffmpegを使う</p>
  </li>
</ul>

</section>
<section>

<h3>プログレッシブダウンロードしやすい形式</h3>

<p>mp4のメタデータであるmoov atomをmp4ファイルの先頭に配置してやる必要がある。おそらくmoov atom内に各動画セグメントのサイズ情報があると思われる。</p>

</section>
</section>

<section>
<section>

<h3>ffmepgについて</h3>

<ul>
  <li>動画関係ならなんでもできる便利ツール</li>
  <li>よくアーミーナイフに例えられる<br>
<img src="59756310-69ee9700-92c4-11e9-93ac-959fd9a74455.jpg" alt="アーミーナイフ">
</li>
</ul>

</section>
<section>

<p>なお実際は・・・</p>

<p><img src="02_px400.jpg" alt="アーミーナイフ2"></p>

</section>
<section>

<p>(^q^)</p>

</section>
</section>
<section>

<h3>moov atomを先頭に配置する</h3>
<p>以下のコマンドを実行する</p>
<pre><code class="language-sh">$ ffmpeg -i input.mp4 -c copy -movflags +faststart output.mp4
</code></pre>

</section>
<section>

<p>プログレッシブダウンロードしても動画再生が重い時</p>

<ul>
  <li>まず画質が良すぎることを疑う
    <ul>
      <li>解像度・ビットレートを下げることを検討する</li>
    </ul>
  </li>
</ul>

</section>
<section>

<h3>画質の変更の仕方</h3>
<p>ffmpegで変換する<br>
※解像度を640x480,動画のビットレートを768kbpsに変換する例</p>
<pre><code class="language-sh">$ ffmpeg -i input.mp4 -s 640x480 -vb 768k output.mp4
</code></pre>

</section>
<section>

<h3>画質の変更のコツてきなもの</h3>

<ul>
  <li>解像度は再生するUIに合わせる。
    <ul>
      <li>例えば再生するvideoのサイズが640x480なのに元の動画の解像度が1280x720だった場合無駄に良すぎるので再生する予定のサイズに合わせる</li>
    </ul>
  </li>
  <li>
    <p>ビットレートは妥協できる範囲を手探りでさがす</p>
  </li>
  <li>fpsは変更しない
    <ul>
      <li>慣れていないと痛い目をみるため</li>
    </ul>
  </li>
</ul>

</section>
<section>

<h3>画質下げても重い時</h3>
<ul>
  <li>CDN使う
    <ul>
      <li>調べた感じユーザー数1万とか割と小規模な動画配信サービスでもCDN使ってることが多い印象</li>
    </ul>
  </li>
</ul>

</section>

  </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>


<script>
  (function() {
  function extend( a, b ) {
    for(var i in b) {
      a[i] = b[i];
    }
  }
  var baseOptions = {
    transition: 'default',

    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
    ]
  };

  

  var configOptions = {"controls":true,"progress":true,"history":true,"center":true}
  var initializeOptions = {};
  extend(initializeOptions, baseOptions);
  extend(initializeOptions, configOptions);
  Reveal.initialize(initializeOptions);
})();

</script>

  </body>
</html>
